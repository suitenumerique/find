---
environments:
  dev:
    values:
      - version: 0.0.2
    secrets:
      - env.d/{{ .Environment.Name }}/secrets.enc.yaml
---
repositories:
  - name: bitnami
    url: registry-1.docker.io/bitnamicharts
    oci: true

releases:
  - name: postgres
    installed: {{ eq .Environment.Name "dev" | toYaml }}
    namespace: {{ .Namespace }}
    chart: bitnami/postgresql
    version: 13.1.5
    values:
      - image:
          tag: 15.10.0
      - auth:
          username: dinum
          password: pass
          database: find
      - tls:
          enabled: true
          autoGenerated: true

  - name: redis
    installed: {{ eq .Environment.Name "dev" | toYaml }}
    namespace: {{ .Namespace }}
    chart: bitnami/redis
    version: 18.19.2
    values:
      - auth:
          password: pass
        architecture: standalone

  - name: extra
    installed: {{ eq .Environment.Name "dev" | toYaml }}
    namespace: {{ .Namespace }}
    chart: ./extra
    secrets:
      - env.d/{{ .Environment.Name }}/secrets.enc.yaml

  - name: opensearch
    namespace: {{ .Namespace }}
    chart: bitnami/opensearch
    version: 1.5.1
    values:
      - env.d/{{ .Environment.Name }}/values.opensearch.yaml.gotmpl
    secrets:
      - env.d/{{ .Environment.Name }}/secrets.enc.yaml
    ### documentation
    # https://opster.com/guides/opensearch/opensearch-basics/opensearch-security-access-control-users-roles-permissions/
    # https://opster.com/guides/opensearch/opensearch-security/changing-admin-password-opensearch/

  - name: find
    version: {{ .Values.version }}
    namespace: {{ .Namespace }}
    chart: ./find
    values:
      - env.d/{{ .Environment.Name }}/values.find.yaml.gotmpl
    secrets:
      - env.d/{{ .Environment.Name }}/secrets.enc.yaml
